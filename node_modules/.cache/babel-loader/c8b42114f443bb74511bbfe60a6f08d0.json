{"ast":null,"code":"import \"antd/es/card/style\";\nimport _Card from \"antd/es/card\";\nimport \"antd/es/table/style\";\nimport _Table from \"antd/es/table\";\nimport \"antd/es/button/style\";\nimport _Button from \"antd/es/button\";\nimport \"antd/es/message/style\";\nimport _message from \"antd/es/message\";\nimport \"antd/es/modal/style\";\nimport _Modal from \"antd/es/modal\";\nvar _jsxFileName = \"C:\\\\Users\\\\itryl\\\\Desktop\\\\React client\\\\client\\\\src\\\\pages\\\\user\\\\index.jsx\";\nimport React, { Component } from 'react';\nimport formateDate from \"../../utils/dateUtils\";\nimport LinkButton from \"../../components/link-button/index\";\nimport { reqDeleteUser, reqUsers, reqAddOrUpdateUser } from \"../../api/index\";\nimport UserForm from './user-form';\n/*\r\n用户路由\r\n */\n\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport default class User extends Component {\n  constructor(...args) {\n    super(...args);\n    this.state = {\n      users: [],\n      // 所有用户列表\n      roles: [],\n      // 所有角色列表\n      isShow: false // 是否显示确认框\n\n    };\n\n    this.initColumns = () => {\n      this.columns = [{\n        title: '用户名',\n        dataIndex: 'username'\n      }, {\n        title: '邮箱',\n        dataIndex: 'email'\n      }, {\n        title: '电话',\n        dataIndex: 'phone'\n      }, {\n        title: '注册时间',\n        dataIndex: 'create_time',\n        render: formateDate\n      }, {\n        title: '所属角色',\n        dataIndex: 'role_id',\n        render: role_id => this.roleNames[role_id]\n      }, {\n        title: '操作',\n        render: user => /*#__PURE__*/_jsxDEV(\"span\", {\n          children: [/*#__PURE__*/_jsxDEV(LinkButton, {\n            onClick: () => this.showUpdate(user),\n            children: \"\\u4FEE\\u6539\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 54,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(LinkButton, {\n            onClick: () => this.deleteUser(user),\n            children: \"\\u5220\\u9664\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 55,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 53,\n          columnNumber: 11\n        }, this)\n      }];\n    };\n\n    this.initRoleNames = roles => {\n      const roleNames = roles.reduce((pre, role) => {\n        pre[role._id] = role.name;\n        return pre;\n      }, {}); // 保存\n\n      this.roleNames = roleNames;\n    };\n\n    this.showAdd = () => {\n      this.user = null; // 去除前面保存的user\n\n      this.setState({\n        isShow: true\n      });\n    };\n\n    this.showUpdate = user => {\n      this.user = user; // 保存user\n\n      this.setState({\n        isShow: true\n      });\n    };\n\n    this.deleteUser = user => {\n      _Modal.confirm({\n        title: `确认删除${user.username}吗?`,\n        onOk: async () => {\n          const result = await reqDeleteUser(user._id);\n\n          if (result.status === 0) {\n            _message.success('删除用户成功!');\n\n            this.getUsers();\n          }\n        }\n      });\n    };\n\n    this.addOrUpdateUser = async () => {\n      this.setState({\n        isShow: false\n      }); // 1. 收集输入数据\n\n      const user = this.form.getFieldsValue();\n      this.form.resetFields(); // 如果是更新, 需要给user指定_id属性\n\n      if (this.user) {\n        user._id = this.user._id;\n      } // 2. 提交添加的请求\n\n\n      const result = await reqAddOrUpdateUser(user); // 3. 更新列表显示\n\n      if (result.status === 0) {\n        _message.success(`${this.user ? '修改' : '添加'}用户成功`);\n\n        this.getUsers();\n      }\n    };\n\n    this.getUsers = async () => {\n      const result = await reqUsers();\n\n      if (result.status === 0) {\n        const {\n          users,\n          roles\n        } = result.data;\n        this.initRoleNames(roles);\n        this.setState({\n          users,\n          roles\n        });\n      }\n    };\n  }\n\n  componentWillMount() {\n    this.initColumns();\n  }\n\n  componentDidMount() {\n    this.getUsers();\n  }\n\n  render() {\n    const {\n      users,\n      roles,\n      isShow\n    } = this.state;\n    const user = this.user || {};\n\n    const title = /*#__PURE__*/_jsxDEV(_Button, {\n      type: \"primary\",\n      onClick: this.showAdd,\n      children: \"\\u521B\\u5EFA\\u7528\\u6237\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 158,\n      columnNumber: 19\n    }, this);\n\n    return /*#__PURE__*/_jsxDEV(_Card, {\n      title: title,\n      children: [/*#__PURE__*/_jsxDEV(_Table, {\n        bordered: true,\n        rowKey: \"_id\",\n        dataSource: users,\n        columns: this.columns,\n        pagination: {\n          defaultPageSize: 2\n        }\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 162,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(_Modal, {\n        title: user._id ? '修改用户' : '添加用户',\n        visible: isShow,\n        onOk: this.addOrUpdateUser,\n        onCancel: () => {\n          this.form.resetFields();\n          this.setState({\n            isShow: false\n          });\n        },\n        children: /*#__PURE__*/_jsxDEV(UserForm, {\n          setForm: form => this.form = form,\n          roles: roles,\n          user: user\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 179,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 170,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 161,\n      columnNumber: 7\n    }, this);\n  }\n\n}","map":{"version":3,"sources":["C:/Users/itryl/Desktop/React client/client/src/pages/user/index.jsx"],"names":["React","Component","formateDate","LinkButton","reqDeleteUser","reqUsers","reqAddOrUpdateUser","UserForm","User","state","users","roles","isShow","initColumns","columns","title","dataIndex","render","role_id","roleNames","user","showUpdate","deleteUser","initRoleNames","reduce","pre","role","_id","name","showAdd","setState","confirm","username","onOk","result","status","success","getUsers","addOrUpdateUser","form","getFieldsValue","resetFields","data","componentWillMount","componentDidMount","defaultPageSize"],"mappings":"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","sourcesContent":["import React, {Component} from 'react'\r\nimport {\r\n  Card,\r\n  Button,\r\n  Table,\r\n  Modal,\r\n  message\r\n} from 'antd'\r\nimport formateDate from \"../../utils/dateUtils\"\r\nimport LinkButton from \"../../components/link-button/index\"\r\nimport {reqDeleteUser, reqUsers, reqAddOrUpdateUser} from \"../../api/index\";\r\nimport UserForm from './user-form'\r\n\r\n/*\r\n用户路由\r\n */\r\nexport default class User extends Component {\r\n\r\n  state = {\r\n    users: [], // 所有用户列表\r\n    roles: [], // 所有角色列表\r\n    isShow: false, // 是否显示确认框\r\n  }\r\n\r\n  initColumns = () => {\r\n    this.columns = [\r\n      {\r\n        title: '用户名',\r\n        dataIndex: 'username'\r\n      },\r\n      {\r\n        title: '邮箱',\r\n        dataIndex: 'email'\r\n      },\r\n\r\n      {\r\n        title: '电话',\r\n        dataIndex: 'phone'\r\n      },\r\n      {\r\n        title: '注册时间',\r\n        dataIndex: 'create_time',\r\n        render: formateDate\r\n      },\r\n      {\r\n        title: '所属角色',\r\n        dataIndex: 'role_id',\r\n        render: (role_id) => this.roleNames[role_id]\r\n      },\r\n      {\r\n        title: '操作',\r\n        render: (user) => (\r\n          <span>\r\n            <LinkButton onClick={() => this.showUpdate(user)}>修改</LinkButton>\r\n            <LinkButton onClick={() => this.deleteUser(user)}>删除</LinkButton>\r\n          </span>\r\n        )\r\n      },\r\n    ]\r\n  }\r\n\r\n  /*\r\n  根据role的数组, 生成包含所有角色名的对象(属性名用角色id值)\r\n   */\r\n  initRoleNames = (roles) => {\r\n    const roleNames = roles.reduce((pre, role) => {\r\n      pre[role._id] = role.name\r\n      return pre\r\n    }, {})\r\n    // 保存\r\n    this.roleNames = roleNames\r\n  }\r\n\r\n  /*\r\n  显示添加界面\r\n   */\r\n  showAdd = () => {\r\n    this.user = null // 去除前面保存的user\r\n    this.setState({isShow: true})\r\n  }\r\n\r\n  /*\r\n  显示修改界面\r\n   */\r\n  showUpdate = (user) => {\r\n    this.user = user // 保存user\r\n    this.setState({\r\n      isShow: true\r\n    })\r\n  }\r\n\r\n  /*\r\n  删除指定用户\r\n   */\r\n  deleteUser = (user) => {\r\n    Modal.confirm({\r\n      title: `确认删除${user.username}吗?`,\r\n      onOk: async () => {\r\n        const result = await reqDeleteUser(user._id)\r\n        if(result.status===0) {\r\n          message.success('删除用户成功!')\r\n          this.getUsers()\r\n        }\r\n      }\r\n    })\r\n  }\r\n\r\n  /*\r\n  添加/更新用户\r\n   */\r\n  addOrUpdateUser = async () => {\r\n\r\n    this.setState({isShow: false})\r\n\r\n    // 1. 收集输入数据\r\n    const user = this.form.getFieldsValue()\r\n    this.form.resetFields()\r\n    // 如果是更新, 需要给user指定_id属性\r\n    if (this.user) {\r\n      user._id = this.user._id\r\n    }\r\n\r\n    // 2. 提交添加的请求\r\n    const result = await reqAddOrUpdateUser(user)\r\n    // 3. 更新列表显示\r\n    if(result.status===0) {\r\n      message.success(`${this.user ? '修改' : '添加'}用户成功`)\r\n      this.getUsers()\r\n    }\r\n  }\r\n\r\n  getUsers = async () => {\r\n    const result = await reqUsers()\r\n    if (result.status===0) {\r\n      const {users, roles} = result.data\r\n      this.initRoleNames(roles)\r\n      this.setState({\r\n        users,\r\n        roles\r\n      })\r\n    }\r\n  }\r\n\r\n  componentWillMount () {\r\n    this.initColumns()\r\n  }\r\n\r\n  componentDidMount () {\r\n    this.getUsers()\r\n  }\r\n\r\n\r\n  render() {\r\n\r\n    const {users, roles, isShow} = this.state\r\n    const user = this.user || {}\r\n\r\n    const title = <Button type='primary' onClick={this.showAdd}>创建用户</Button>\r\n\r\n    return (\r\n      <Card title={title}>\r\n        <Table\r\n          bordered\r\n          rowKey='_id'\r\n          dataSource={users}\r\n          columns={this.columns}\r\n          pagination={{defaultPageSize: 2}}\r\n        />\r\n\r\n        <Modal\r\n          title={user._id ? '修改用户' : '添加用户'}\r\n          visible={isShow}\r\n          onOk={this.addOrUpdateUser}\r\n          onCancel={() => {\r\n            this.form.resetFields()\r\n            this.setState({isShow: false})\r\n          }}\r\n        >\r\n          <UserForm\r\n            setForm={form => this.form = form}\r\n            roles={roles}\r\n            user={user}\r\n          />\r\n        </Modal>\r\n\r\n      </Card>\r\n    )\r\n  }\r\n}"]},"metadata":{},"sourceType":"module"}