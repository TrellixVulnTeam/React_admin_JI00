{"ast":null,"code":"import\"antd/es/card/style\";import _Card from\"antd/es/card\";import\"antd/es/table/style\";import _Table from\"antd/es/table\";import\"antd/es/icon/style\";import _Icon from\"antd/es/icon\";import\"antd/es/input/style\";import _Input from\"antd/es/input\";import _regeneratorRuntime from\"C:/Users/itryl/Desktop/React client/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import\"antd/es/message/style\";import _message from\"antd/es/message\";import _asyncToGenerator from\"C:/Users/itryl/Desktop/React client/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import\"antd/es/button/style\";import _Button from\"antd/es/button\";import _classCallCheck from\"C:/Users/itryl/Desktop/React client/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"C:/Users/itryl/Desktop/React client/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _inherits from\"C:/Users/itryl/Desktop/React client/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"C:/Users/itryl/Desktop/React client/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import\"antd/es/select/style\";import _Select from\"antd/es/select\";import React,{Component}from'react';import{reqProducts,reqSearchProducts,reqUpdateSataus}from'../../api/index';import LinkButton from'../../components/link-button';import{PAGE_SIZE}from'../../utils/constants';//Product的默认子路由组件\nimport{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var Option=_Select.Option;var ProductHome=/*#__PURE__*/function(_Component){_inherits(ProductHome,_Component);var _super=_createSuper(ProductHome);function ProductHome(){var _this;_classCallCheck(this,ProductHome);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_super.call.apply(_super,[this].concat(args));_this.state={products:[],//商品的数组\ntotal:0,//总的数据条数\nloading:false,//状态\nsearchName:'',//搜索的关键字\nsearchType:'productName'//根据哪个字段来搜索\n};_this.initColumns=function(){return _this.columns=[{title:'商品名称',dataIndex:'name'},{title:'商品描述',dataIndex:'desc'},{title:'价格',render:function render(product){return'￥'+product.price;}//当前指定了对应的属性 \n},{width:100,title:'状态',render:function render(product){var status=product.status,_id=product._id;var newStatus=status===1?2:1;return/*#__PURE__*/_jsxs(\"span\",{children:[/*#__PURE__*/_jsx(_Button,{onClick:function onClick(){_this.updateStatus(_id,newStatus);},type:\"primary\",children:status===1?'下架':'上架'}),/*#__PURE__*/_jsx(\"span\",{children:status===1?'在售':'已下架'})]});}},{width:100,title:'操作',render:function render(product){return/*#__PURE__*/_jsxs(\"span\",{children:[/*#__PURE__*/_jsx(LinkButton,{onClick:function onClick(){return _this.props.history.push('/product/detail',{product:product});},children:\"\\u8BE6\\u60C5\"}),/*#__PURE__*/_jsx(LinkButton,{onClick:function onClick(){_this.props.history.push('/product/addupdate',product);},children:\"\\u4FEE\\u6539\"})]});}}];};_this.updateStatus=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(productId,status){var result;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return reqUpdateSataus(productId,status);case 2:result=_context.sent;if(result.status===0){_message.success('更新商品成功');_this.getProducts(_this.pageNum);}case 4:case\"end\":return _context.stop();}}},_callee);}));return function(_x,_x2){return _ref.apply(this,arguments);};}();_this.getProducts=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(pageNum){var _this$state,searchName,searchType,result,_result$data,total,list;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_this.pageNum=pageNum;//保存pageNum，让其他方法可以看到\n_this.setState({loading:true});//显示loading\n_this$state=_this.state,searchName=_this$state.searchName,searchType=_this$state.searchType;//如果搜索关键字有值，就是搜索分页\nif(!searchName){_context2.next=9;break;}_context2.next=6;return reqSearchProducts({pageNum:pageNum,pageSize:PAGE_SIZE,searchName:searchName,searchType:searchType});case 6:result=_context2.sent;_context2.next=12;break;case 9:_context2.next=11;return reqProducts(pageNum,PAGE_SIZE);case 11:result=_context2.sent;case 12:_this.setState({loading:false});//请求结束之后 隐藏loading\nif(result.status===0){//取出分页数据，更新状态，显示分页列表\n_result$data=result.data,total=_result$data.total,list=_result$data.list;_this.setState({total:total,products:list});}case 14:case\"end\":return _context2.stop();}}},_callee2);}));return function(_x3){return _ref2.apply(this,arguments);};}();return _this;}_createClass(ProductHome,[{key:\"componentWillMount\",value:function componentWillMount(){this.initColumns();//调用初始化列的方法\n}},{key:\"componentDidMount\",value:function componentDidMount(){this.getProducts(1);//调用获取商品的方法\n}},{key:\"render\",value:function render(){var _this2=this;//取出状态数据\nvar _this$state2=this.state,products=_this$state2.products,total=_this$state2.total,loading=_this$state2.loading,searchName=_this$state2.searchName,searchType=_this$state2.searchType;var title=/*#__PURE__*/_jsxs(\"span\",{children:[/*#__PURE__*/_jsxs(_Select,{value:searchType,style:{width:150},onChange:function onChange(value){return _this2.setState({searchType:value});},children:[/*#__PURE__*/_jsx(Option,{value:\"productName\",children:\"\\u6309\\u540D\\u79F0\\u641C\\u7D22\"}),/*#__PURE__*/_jsx(Option,{value:\"productDesc\",children:\"\\u6309\\u63CF\\u8FF0\\u641C\\u7D22\"})]}),/*#__PURE__*/_jsx(_Input,{placeholder:\"\\u5173\\u952E\\u5B57\",style:{width:150,margin:'0 15px'},value:searchName,onChange:function onChange(e){_this2.setState({searchName:e.target.value});}}),/*#__PURE__*/_jsx(_Button,{type:\"primary\",onClick:function onClick(){_this2.getProducts(1);},children:\"\\u641C\\u7D22\"})]});var extra=/*#__PURE__*/_jsxs(_Button,{type:\"primary\",onClick:function onClick(){_this2.props.history.push('/product/addupdate');},children:[/*#__PURE__*/_jsx(_Icon,{type:\"plus\"}),\"   \\u6DFB\\u52A0\\u5546\\u54C1\"]});return/*#__PURE__*/_jsx(_Card,{title:title,extra:extra,children:/*#__PURE__*/_jsx(_Table,{dataSource:products,columns:this.columns,current:this.pageNum//让当前页数等于pageNum\n,rowKey:\"_id\",bordered:true,loading:loading,pagination:{defaultPageSize:PAGE_SIZE,showQuickJumper:true,total:total,onChange:function onChange(pageNum){_this2.getProducts(pageNum);}}})});}}]);return ProductHome;}(Component);export{ProductHome as default};","map":{"version":3,"sources":["C:/Users/itryl/Desktop/React client/client/src/pages/products/home.jsx"],"names":["React","Component","reqProducts","reqSearchProducts","reqUpdateSataus","LinkButton","PAGE_SIZE","Option","ProductHome","state","products","total","loading","searchName","searchType","initColumns","columns","title","dataIndex","render","product","price","width","status","_id","newStatus","updateStatus","props","history","push","productId","result","success","getProducts","pageNum","setState","pageSize","data","list","value","margin","e","target","extra","defaultPageSize","showQuickJumper","onChange"],"mappings":"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","sourcesContent":["import React, { Component } from 'react'\r\nimport {Card,Select,Input,Button,Icon,Table, message} from 'antd'\r\nimport {reqProducts,reqSearchProducts,reqUpdateSataus} from '../../api/index'\r\nimport LinkButton from '../../components/link-button'\r\nimport {PAGE_SIZE} from '../../utils/constants'\r\n//Product的默认子路由组件\r\nconst Option=Select.Option\r\nexport default class ProductHome extends Component {\r\n    state={\r\n        products:[ ], //商品的数组\r\n        total:0,  //总的数据条数\r\n        loading:false,    //状态\r\n        searchName:'',   //搜索的关键字\r\n        searchType:'productName'    //根据哪个字段来搜索\r\n    }\r\n    //初始化列的方法\r\n    initColumns=()=>{\r\n        return this.columns=[\r\n            {\r\n              title: '商品名称',\r\n              dataIndex: 'name',\r\n            },\r\n            {\r\n              title: '商品描述',\r\n              dataIndex: 'desc',\r\n            },\r\n            {\r\n              title: '价格',\r\n              render:(product)=>\r\n                    '￥'+ product.price    //当前指定了对应的属性 \r\n            },\r\n            {\r\n                width:100,\r\n                title: '状态',\r\n                render:(product)=>{\r\n                    const {status,_id}=product\r\n                    const newStatus=status===1?2:1\r\n                    return (\r\n                        <span>\r\n                            <Button onClick={()=>{this.updateStatus(_id,newStatus)}}\r\n                             type='primary'>\r\n                            {status===1?'下架':'上架'}</Button>\r\n                            <span>{status===1?'在售':'已下架'}</span>\r\n                        </span>\r\n                    )\r\n                }\r\n            },\r\n            {\r\n                width:100,\r\n                title: '操作',\r\n                render:(product)=>{\r\n                    return (\r\n                        <span>\r\n                            {/* 将product对象 使用state传递给目标路由组件 */}\r\n                            <LinkButton onClick={()=>this.props.history.push('/product/detail',{product})}>详情</LinkButton>\r\n                            <LinkButton onClick={()=>{this.props.history.push('/product/addupdate',product)}}>修改</LinkButton>\r\n                        </span>\r\n                    )\r\n                }\r\n            }\r\n          ]\r\n    }\r\n    //更新指定商品的状态\r\n    updateStatus=async(productId,status)=>{\r\n        const result=await reqUpdateSataus(productId,status)\r\n       if(result.status===0){\r\n           message.success('更新商品成功')\r\n           this.getProducts(this.pageNum)\r\n       }\r\n    }\r\n    //获取商品的方法\r\n    getProducts=async(pageNum)=>{\r\n        this.pageNum=pageNum   //保存pageNum，让其他方法可以看到\r\n        this.setState({loading:true})  //显示loading\r\n        const {searchName,searchType} =this.state\r\n        //如果搜索关键字有值，就是搜索分页\r\n        let result\r\n        if(searchName){\r\n            result=  await  reqSearchProducts({pageNum,pageSize:PAGE_SIZE,searchName,searchType})\r\n        }else{  //一般分页请求\r\n             result= await reqProducts(pageNum,PAGE_SIZE)\r\n        }\r\n       this.setState({loading:false})  //请求结束之后 隐藏loading\r\n        if(result.status===0){\r\n            //取出分页数据，更新状态，显示分页列表\r\n            const {total,list}=result.data\r\n            this.setState({total,products:list})\r\n        }\r\n    }\r\n    componentWillMount(){\r\n        this.initColumns()  //调用初始化列的方法\r\n    }\r\n    componentDidMount(){\r\n        this.getProducts(1)   //调用获取商品的方法\r\n    }\r\n    render() {\r\n        //取出状态数据\r\n        const {products,total,loading,searchName,searchType}=this.state\r\n       \r\n        const title=(\r\n            <span>\r\n                <Select value={searchType} style={{width:150}} onChange={value=>this.setState({searchType:value})}>\r\n                    <Option value='productName'>按名称搜索</Option>\r\n                    <Option value='productDesc'>按描述搜索</Option>\r\n                </Select>\r\n                <Input placeholder='关键字' style={{width:150,margin:'0 15px'}} value={searchName} onChange={(e)=>{this.setState({searchName:e.target.value})}}></Input>\r\n                <Button type='primary' onClick={()=>{this.getProducts(1)}}>搜索</Button>\r\n            </span>\r\n        )\r\n        const extra=(\r\n           <Button type='primary' onClick={()=>{this.props.history.push('/product/addupdate')}}>\r\n                <Icon type='plus' ></Icon>   添加商品\r\n           </Button>\r\n        )\r\n        return (\r\n          <Card title={title} extra={extra}>\r\n              <Table dataSource={products}\r\n               columns={this.columns} \r\n               current={this.pageNum}   //让当前页数等于pageNum\r\n               rowKey='_id'\r\n                bordered\r\n                loading={loading}\r\n              pagination={{defaultPageSize:PAGE_SIZE,\r\n                showQuickJumper:true,\r\n                total,\r\n                onChange:(pageNum)=>{this.getProducts(pageNum)},\r\n            }}\r\n              ></Table>\r\n          </Card>\r\n        )\r\n    }\r\n}\r\n"]},"metadata":{},"sourceType":"module"}