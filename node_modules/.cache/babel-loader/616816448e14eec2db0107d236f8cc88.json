{"ast":null,"code":"import \"antd/es/card/style\";\nimport _Card from \"antd/es/card\";\nimport \"antd/es/table/style\";\nimport _Table from \"antd/es/table\";\nimport \"antd/es/button/style\";\nimport _Button from \"antd/es/button\";\nimport \"antd/es/message/style\";\nimport _message from \"antd/es/message\";\nimport \"antd/es/modal/style\";\nimport _Modal from \"antd/es/modal\";\nvar _jsxFileName = \"C:\\\\Users\\\\itryl\\\\Desktop\\\\React client\\\\client\\\\src\\\\pages\\\\user\\\\index.jsx\";\nimport React, { Component } from 'react';\nimport formateDate from '../../utils/dateUtils';\nimport { reqUsers, reqDeleteUser } from '../../api/index';\nimport LinkButton from '../../components/link-button';\nimport UserForm from './user-form';\nimport { reqAddOrUpdateUser } from '../../api/index';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport default class User extends Component {\n  constructor(...args) {\n    super(...args);\n    this.state = {\n      isShow: false,\n      //对话框的显示隐藏\n      users: [],\n      //所有用户的数组\n      roles: [] //所有角色的列表\n\n    };\n\n    this.showAdd = () => {\n      this.user = null; //去除前面保存的user\n\n      this.setState({\n        isShow: true\n      });\n    };\n\n    this.showUpdate = user => {\n      this.user = user; //保存user\n\n      this.setState({\n        isShow: true\n      });\n    };\n\n    this.deleteUser = user => {\n      _Modal.confirm({\n        title: `确认删除${user.username}吗？`,\n        onOk: async () => {\n          const result = await reqDeleteUser(user._id);\n\n          if (result.status === 0) {\n            _message.success('删除用户成功');\n\n            this.getUsers();\n          } else {\n            _message.error('删除用户失败');\n          }\n        }\n      });\n    };\n\n    this.getUsers = async () => {\n      const result = await reqUsers();\n      console.log(result.data.users);\n\n      if (result.status === 0) {\n        const {\n          users,\n          roles\n        } = result.data;\n        this.initRoleNames(roles); //根据roles数组生成roles对应的名字\n\n        this.setState({\n          users,\n          roles\n        });\n      }\n    };\n\n    this.initRoleNames = roles => {\n      const roleNames = roles.reduce((pre, role, cur) => {\n        pre[role._id] = role.name;\n        return pre;\n      }, {}); //保存\n\n      this.roleNames = roleNames;\n    };\n\n    this.initColumns = () => {\n      this.columns = [{\n        title: '用户名',\n        dataIndex: 'username'\n      }, {\n        title: '邮箱',\n        dataIndex: 'email'\n      }, {\n        title: '电话',\n        dataIndex: 'phone'\n      }, {\n        title: '注册时间',\n        dataIndex: 'create_time',\n        render: formateDate\n      }, {\n        title: '所属角色',\n        dataIndex: 'role_id',\n        render: role_id => this.roleNames[role_id]\n      }, {\n        title: '操作',\n        render: user => /*#__PURE__*/_jsxDEV(\"span\", {\n          children: [/*#__PURE__*/_jsxDEV(LinkButton, {\n            onClick: () => {\n              this.showUpdate(user);\n            },\n            children: \"\\u4FEE\\u6539\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 91,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(LinkButton, {\n            onClick: () => {\n              this.deleteUser(user);\n            },\n            children: \"\\u5220\\u9664\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 92,\n            columnNumber: 25\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 90,\n          columnNumber: 21\n        }, this)\n      }];\n    };\n\n    this.addOrUpdate = async () => {\n      //1.收集输入数据\n      const user = this.form.getFieldsValue();\n      console.log(user);\n      this.form.resetFields(); //如果是更新，需要给\n\n      if (this.user) {\n        //修改\n        user._id = this.user._id;\n      } //2.提交添加的请求\n\n\n      const result = await reqAddOrUpdateUser(user); //3.更新列表显示\n\n      if (result.status === 0) {\n        _message.success(`${this.user ? '修改' : '添加'}用户成功`);\n\n        this.getUsers();\n      }\n\n      this.setState({\n        isShow: false\n      });\n    };\n  }\n\n  componentWillMount() {\n    //调用初始化列的方法\n    this.initColumns();\n  }\n\n  componentDidMount() {\n    //调用所有用户的列表\n    this.getUsers();\n  } //添加或者更新用户\n\n\n  render() {\n    const title = /*#__PURE__*/_jsxDEV(_Button, {\n      type: \"primary\",\n      onClick: this.showAdd,\n      children: \"\\u521B\\u5EFA\\u7528\\u6237\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 127,\n      columnNumber: 13\n    }, this);\n\n    const {\n      isShow,\n      users,\n      roles\n    } = this.state;\n    const user = this.user || {}; //上来是没有user的，防止报错\n\n    return /*#__PURE__*/_jsxDEV(_Card, {\n      title: title,\n      children: [/*#__PURE__*/_jsxDEV(_Table, {\n        bordered: true,\n        rowKey: \"\",\n        dataSource: users,\n        columns: this.columns,\n        pagination: {\n          defaultPageSize: 5,\n          showQuickJumper: true\n        }\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 133,\n        columnNumber: 16\n      }, this), /*#__PURE__*/_jsxDEV(_Modal, {\n        title: user._id ? '修改用户' : '添加用户',\n        visible: isShow,\n        onOk: this.addOrUpdate,\n        onCancel: () => {\n          this.form.resetFields(), this.setState({\n            isShow: false\n          });\n        },\n        children: /*#__PURE__*/_jsxDEV(UserForm, {\n          setForm: form => {\n            this.form = form;\n          },\n          roles: roles,\n          user: user\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 148,\n          columnNumber: 20\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 141,\n        columnNumber: 16\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 132,\n      columnNumber: 12\n    }, this);\n  }\n\n}","map":{"version":3,"sources":["C:/Users/itryl/Desktop/React client/client/src/pages/user/index.jsx"],"names":["React","Component","formateDate","reqUsers","reqDeleteUser","LinkButton","UserForm","reqAddOrUpdateUser","User","state","isShow","users","roles","showAdd","user","setState","showUpdate","deleteUser","confirm","title","username","onOk","result","_id","status","success","getUsers","error","console","log","data","initRoleNames","roleNames","reduce","pre","role","cur","name","initColumns","columns","dataIndex","render","role_id","addOrUpdate","form","getFieldsValue","resetFields","componentWillMount","componentDidMount","defaultPageSize","showQuickJumper"],"mappings":"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","sourcesContent":["import React, { Component } from 'react'\r\nimport{\r\n    Card,Button,Table,Modal, message\r\n} from 'antd'\r\nimport formateDate from '../../utils/dateUtils'\r\nimport {reqUsers,reqDeleteUser} from '../../api/index'\r\nimport LinkButton from '../../components/link-button'\r\nimport UserForm from './user-form'\r\nimport {reqAddOrUpdateUser} from '../../api/index'\r\nexport default class User extends Component {\r\n    state={\r\n        isShow:false,  //对话框的显示隐藏\r\n        users:[],  //所有用户的数组\r\n        roles:[],   //所有角色的列表\r\n    }\r\n    //显示添加界面\r\n    showAdd=()=>{\r\n        this.user=null  //去除前面保存的user\r\n        this.setState({isShow:true})\r\n    }\r\n    //显示修改界面\r\n    showUpdate=(user)=>{\r\n        this.user=user  //保存user\r\n        this.setState({isShow:true})\r\n    }\r\n    //删除指定用户\r\n    deleteUser=(user)=>{\r\n        Modal.confirm({\r\n            title:`确认删除${user.username}吗？`,\r\n            onOk:async()=>{\r\n                const result=await reqDeleteUser(user._id)\r\n                if(result.status===0){\r\n                    message.success('删除用户成功')\r\n                    this.getUsers()\r\n                }else{\r\n                    message.error('删除用户失败')\r\n                }\r\n            }\r\n        })\r\n    }\r\n    //获取所有用户的方法\r\n    getUsers=async()=>{\r\n        const result=await reqUsers()\r\n        console.log(result.data.users)\r\n        if(result.status===0){\r\n            const {users,roles}=result.data\r\n            this.initRoleNames(roles)   //根据roles数组生成roles对应的名字\r\n            this.setState({\r\n                users,roles\r\n            })\r\n        }\r\n    }\r\n    //根据roles数组生成包含所有角色名的对象(属性名用角色id值)\r\n    initRoleNames=(roles)=>{    \r\n        const roleNames=roles.reduce((pre,role,cur)=>{\r\n            pre[role._id]=role.name\r\n            return pre\r\n        },{})\r\n        //保存\r\n        this.roleNames=roleNames\r\n    }\r\n    //初始化列的方法\r\n    initColumns=()=>{\r\n        this.columns=[\r\n            {\r\n                title:'用户名',\r\n                dataIndex:'username',\r\n            },\r\n            {\r\n                title:'邮箱',\r\n                dataIndex:'email'\r\n            },\r\n            {\r\n                title:'电话',\r\n                dataIndex:'phone'\r\n            },\r\n            {\r\n                title:'注册时间',\r\n                dataIndex:'create_time',\r\n                render:formateDate\r\n            },\r\n            {\r\n                title:'所属角色',\r\n                dataIndex:'role_id',\r\n                render:(role_id)=>this.roleNames[role_id]\r\n            },\r\n            {\r\n                title:'操作',\r\n                render:(user)=>(\r\n                    <span>\r\n                        <LinkButton onClick={()=>{this.showUpdate(user)}}>修改</LinkButton>\r\n                        <LinkButton onClick={()=>{this.deleteUser(user)}}>删除</LinkButton>\r\n                    </span>\r\n                )\r\n            }\r\n        ]\r\n    }\r\n    componentWillMount(){\r\n        //调用初始化列的方法\r\n        this.initColumns()\r\n    }\r\n    componentDidMount(){\r\n           //调用所有用户的列表\r\n           this.getUsers()\r\n    }\r\n    //添加或者更新用户\r\n    addOrUpdate=async()=>{\r\n        //1.收集输入数据\r\n        const user= this.form.getFieldsValue()\r\n        console.log(user)\r\n        this.form.resetFields()\r\n        //如果是更新，需要给\r\n        if(this.user){  //修改\r\n            user._id=this.user._id\r\n        }\r\n        //2.提交添加的请求\r\n        const result=await reqAddOrUpdateUser(user)\r\n        //3.更新列表显示\r\n        if(result.status===0){\r\n            message.success(`${this.user?'修改':'添加'}用户成功`)\r\n            this.getUsers()\r\n        }\r\n        this.setState({isShow:false})\r\n    }\r\n    render() {\r\n        const title=(\r\n            <Button type='primary' onClick={this.showAdd}>创建用户</Button>\r\n        )\r\n        const {isShow,users,roles}=this.state\r\n        const user=this.user||{}  //上来是没有user的，防止报错\r\n        return (\r\n           <Card title={title}>\r\n               <Table\r\n                bordered\r\n                rowKey=''\r\n                dataSource={users}\r\n                columns={this.columns}\r\n                pagination={{defaultPageSize:5,showQuickJumper:true}}\r\n               >\r\n               </Table>\r\n               <Modal\r\n                title={user._id?'修改用户':'添加用户'}\r\n                visible={isShow}\r\n                onOk={this.addOrUpdate}\r\n                onCancel={()=>{this.form.resetFields(),this.setState({isShow:false})\r\n            }}\r\n               >\r\n                   <UserForm setForm={(form)=>{this.form=form}} roles={roles} user={user}></UserForm>\r\n               </Modal>\r\n           </Card>\r\n        )\r\n    }\r\n}\r\n"]},"metadata":{},"sourceType":"module"}