{"ast":null,"code":"import\"antd/es/card/style\";import _Card from\"antd/es/card\";import\"antd/es/table/style\";import _Table from\"antd/es/table\";import\"antd/es/button/style\";import _Button from\"antd/es/button\";import _regeneratorRuntime from\"C:/Users/itryl/Desktop/React client/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import\"antd/es/message/style\";import _message from\"antd/es/message\";import _asyncToGenerator from\"C:/Users/itryl/Desktop/React client/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import\"antd/es/modal/style\";import _Modal from\"antd/es/modal\";import _classCallCheck from\"C:/Users/itryl/Desktop/React client/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"C:/Users/itryl/Desktop/React client/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _inherits from\"C:/Users/itryl/Desktop/React client/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"C:/Users/itryl/Desktop/React client/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import React,{Component}from'react';import formateDate from\"../../utils/dateUtils\";import LinkButton from\"../../components/link-button/index\";import{reqDeleteUser,reqUsers,reqAddOrUpdateUser}from\"../../api/index\";import UserForm from'./user-form';/*\r\n用户路由\r\n */import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var User=/*#__PURE__*/function(_Component){_inherits(User,_Component);var _super=_createSuper(User);function User(){var _this;_classCallCheck(this,User);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_super.call.apply(_super,[this].concat(args));_this.state={users:[],// 所有用户列表\nroles:[],// 所有角色列表\nisShow:false// 是否显示确认框\n};_this.initColumns=function(){_this.columns=[{title:'用户名',dataIndex:'username'},{title:'邮箱',dataIndex:'email'},{title:'电话',dataIndex:'phone'},{title:'注册时间',dataIndex:'create_time',render:formateDate},{title:'所属角色',dataIndex:'role_id',render:function render(role_id){return _this.roleNames[role_id];}},{title:'操作',render:function render(user){return/*#__PURE__*/_jsxs(\"span\",{children:[/*#__PURE__*/_jsx(LinkButton,{onClick:function onClick(){return _this.showUpdate(user);},children:\"\\u4FEE\\u6539\"}),/*#__PURE__*/_jsx(LinkButton,{onClick:function onClick(){return _this.deleteUser(user);},children:\"\\u5220\\u9664\"})]});}}];};_this.initRoleNames=function(roles){var roleNames=roles.reduce(function(pre,role){pre[role._id]=role.name;return pre;},{});// 保存\n_this.roleNames=roleNames;};_this.showAdd=function(){_this.user=null;// 去除前面保存的user\n_this.setState({isShow:true});};_this.showUpdate=function(user){_this.user=user;// 保存user\n_this.setState({isShow:true});};_this.deleteUser=function(user){_Modal.confirm({title:\"\\u786E\\u8BA4\\u5220\\u9664\".concat(user.username,\"\\u5417?\"),onOk:function(){var _onOk=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var result;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return reqDeleteUser(user._id);case 2:result=_context.sent;if(result.status===0){_message.success('删除用户成功!');_this.getUsers();}case 4:case\"end\":return _context.stop();}}},_callee);}));function onOk(){return _onOk.apply(this,arguments);}return onOk;}()});};_this.addOrUpdateUser=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var user,result;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_this.setState({isShow:false});// 1. 收集输入数据\nuser=_this.form.getFieldsValue();_this.form.resetFields();// 如果是更新, 需要给user指定_id属性\nif(_this.user){user._id=_this.user._id;}// 2. 提交添加的请求\n_context2.next=6;return reqAddOrUpdateUser(user);case 6:result=_context2.sent;// 3. 更新列表显示\nif(result.status===0){_message.success(\"\".concat(_this.user?'修改':'添加',\"\\u7528\\u6237\\u6210\\u529F\"));_this.getUsers();}case 8:case\"end\":return _context2.stop();}}},_callee2);}));_this.getUsers=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(){var result,_result$data,users,roles;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.next=2;return reqUsers();case 2:result=_context3.sent;if(result.status===0){_result$data=result.data,users=_result$data.users,roles=_result$data.roles;_this.initRoleNames(roles);_this.setState({users:users,roles:roles});}case 4:case\"end\":return _context3.stop();}}},_callee3);}));return _this;}_createClass(User,[{key:\"componentWillMount\",value:function componentWillMount(){this.initColumns();}},{key:\"componentDidMount\",value:function componentDidMount(){this.getUsers();}},{key:\"render\",value:function render(){var _this2=this;var _this$state=this.state,users=_this$state.users,roles=_this$state.roles,isShow=_this$state.isShow;var user=this.user||{};var title=/*#__PURE__*/_jsx(_Button,{type:\"primary\",onClick:this.showAdd,children:\"\\u521B\\u5EFA\\u7528\\u6237\"});return/*#__PURE__*/_jsxs(_Card,{title:title,children:[/*#__PURE__*/_jsx(_Table,{bordered:true,rowKey:\"_id\",dataSource:users,columns:this.columns,pagination:{defaultPageSize:5}}),/*#__PURE__*/_jsx(_Modal,{title:user._id?'修改用户':'添加用户',visible:isShow,onOk:this.addOrUpdateUser,onCancel:function onCancel(){_this2.form.resetFields();_this2.setState({isShow:false});},children:/*#__PURE__*/_jsx(UserForm,{setForm:function setForm(form){return _this2.form=form;},roles:roles,user:user})})]});}}]);return User;}(Component);export{User as default};","map":{"version":3,"sources":["C:/Users/itryl/Desktop/React client/client/src/pages/user/index.jsx"],"names":["React","Component","formateDate","LinkButton","reqDeleteUser","reqUsers","reqAddOrUpdateUser","UserForm","User","state","users","roles","isShow","initColumns","columns","title","dataIndex","render","role_id","roleNames","user","showUpdate","deleteUser","initRoleNames","reduce","pre","role","_id","name","showAdd","setState","confirm","username","onOk","result","status","success","getUsers","addOrUpdateUser","form","getFieldsValue","resetFields","data","defaultPageSize"],"mappings":"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","sourcesContent":["import React, {Component} from 'react'\r\nimport {\r\n  Card,\r\n  Button,\r\n  Table,\r\n  Modal,\r\n  message\r\n} from 'antd'\r\nimport formateDate from \"../../utils/dateUtils\"\r\nimport LinkButton from \"../../components/link-button/index\"\r\nimport {reqDeleteUser, reqUsers, reqAddOrUpdateUser} from \"../../api/index\";\r\nimport UserForm from './user-form'\r\n\r\n/*\r\n用户路由\r\n */\r\nexport default class User extends Component {\r\n\r\n  state = {\r\n    users: [], // 所有用户列表\r\n    roles: [], // 所有角色列表\r\n    isShow: false, // 是否显示确认框\r\n  }\r\n\r\n  initColumns = () => {\r\n    this.columns = [\r\n      {\r\n        title: '用户名',\r\n        dataIndex: 'username'\r\n      },\r\n      {\r\n        title: '邮箱',\r\n        dataIndex: 'email'\r\n      },\r\n\r\n      {\r\n        title: '电话',\r\n        dataIndex: 'phone'\r\n      },\r\n      {\r\n        title: '注册时间',\r\n        dataIndex: 'create_time',\r\n        render: formateDate\r\n      },\r\n      {\r\n        title: '所属角色',\r\n        dataIndex: 'role_id',\r\n        render: (role_id) => this.roleNames[role_id]\r\n      },\r\n      {\r\n        title: '操作',\r\n        render: (user) => (\r\n          <span>\r\n            <LinkButton onClick={() => this.showUpdate(user)}>修改</LinkButton>\r\n            <LinkButton onClick={() => this.deleteUser(user)}>删除</LinkButton>\r\n          </span>\r\n        )\r\n      },\r\n    ]\r\n  }\r\n\r\n  /*\r\n  根据role的数组, 生成包含所有角色名的对象(属性名用角色id值)\r\n   */\r\n  initRoleNames = (roles) => {\r\n    const roleNames = roles.reduce((pre, role) => {\r\n      pre[role._id] = role.name\r\n      return pre\r\n    }, {})\r\n    // 保存\r\n    this.roleNames = roleNames\r\n  }\r\n\r\n  /*\r\n  显示添加界面\r\n   */\r\n  showAdd = () => {\r\n    this.user = null // 去除前面保存的user\r\n    this.setState({isShow: true})\r\n  }\r\n\r\n  /*\r\n  显示修改界面\r\n   */\r\n  showUpdate = (user) => {\r\n    this.user = user // 保存user\r\n    this.setState({\r\n      isShow: true\r\n    })\r\n  }\r\n\r\n  /*\r\n  删除指定用户\r\n   */\r\n  deleteUser = (user) => {\r\n    Modal.confirm({\r\n      title: `确认删除${user.username}吗?`,\r\n      onOk: async () => {\r\n        const result = await reqDeleteUser(user._id)\r\n        if(result.status===0) {\r\n          message.success('删除用户成功!')\r\n          this.getUsers()\r\n        }\r\n      }\r\n    })\r\n  }\r\n\r\n  /*\r\n  添加/更新用户\r\n   */\r\n  addOrUpdateUser = async () => {\r\n\r\n    this.setState({isShow: false})\r\n\r\n    // 1. 收集输入数据\r\n    const user = this.form.getFieldsValue()\r\n    this.form.resetFields()\r\n    // 如果是更新, 需要给user指定_id属性\r\n    if (this.user) {\r\n      user._id = this.user._id\r\n    }\r\n\r\n    // 2. 提交添加的请求\r\n    const result = await reqAddOrUpdateUser(user)\r\n    // 3. 更新列表显示\r\n    if(result.status===0) {\r\n      message.success(`${this.user ? '修改' : '添加'}用户成功`)\r\n      this.getUsers()\r\n    }\r\n  }\r\n\r\n  getUsers = async () => {\r\n    const result = await reqUsers()\r\n    if (result.status===0) {\r\n      const {users, roles} = result.data\r\n      this.initRoleNames(roles)\r\n      this.setState({\r\n        users,\r\n        roles\r\n      })\r\n    }\r\n  }\r\n\r\n  componentWillMount () {\r\n    this.initColumns()\r\n  }\r\n\r\n  componentDidMount () {\r\n    this.getUsers()\r\n  }\r\n\r\n\r\n  render() {\r\n\r\n    const {users, roles, isShow} = this.state\r\n    const user = this.user || {}\r\n\r\n    const title = <Button type='primary' onClick={this.showAdd}>创建用户</Button>\r\n\r\n    return (\r\n      <Card title={title}>\r\n        <Table\r\n          bordered\r\n          rowKey='_id'\r\n          dataSource={users}\r\n          columns={this.columns}\r\n          pagination={{defaultPageSize: 5}}\r\n        />\r\n\r\n        <Modal\r\n          title={user._id ? '修改用户' : '添加用户'}\r\n          visible={isShow}\r\n          onOk={this.addOrUpdateUser}\r\n          onCancel={() => {\r\n            this.form.resetFields()\r\n            this.setState({isShow: false})\r\n          }}\r\n        >\r\n          <UserForm\r\n            setForm={form => this.form = form}\r\n            roles={roles}\r\n            user={user}\r\n          />\r\n        </Modal>\r\n\r\n      </Card>\r\n    )\r\n  }\r\n}"]},"metadata":{},"sourceType":"module"}